<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment</title>
  <style>
    .summary {
      margin: 20px;
      font-size: 18px;
    }
    .summary ul {
      list-style: none;
      padding: 0;
    }
    .summary li {
      margin-bottom: 10px;
    }
    .error {
      color: red;
      font-size: 14px;
    }
    .message {
      font-size: 16px;
      margin-top: 10px;
    }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      let total = parseFloat(localStorage.getItem('total')) || 0;
      let discountedTotal = total;

      const summaryElement = document.getElementById('cart-summary');
      const totalElement = document.getElementById('total-amount');
      const discountMessageElement = document.getElementById('discount-message');
      const discountCodeInput = document.getElementById('discount-code');
      const discountForm = document.getElementById('discount-form');
      const discountButton = document.getElementById('discount-button');
      const paymentForm = document.getElementById('payment-form');

      if (cart.length > 0) {
        const list = document.createElement('ul');
        cart.forEach(item => {
          const listItem = document.createElement('li');
          listItem.textContent = `${item.quantity} x ${item.ticketType} @ $${item.price} each`;
          list.appendChild(listItem);
        });
        summaryElement.appendChild(list);
        totalElement.textContent = `Total: $${total.toFixed(2)}`;
      } else {
        summaryElement.textContent = 'No items in cart.';
      }

      discountForm.addEventListener('submit', (event) => {
        event.preventDefault();
        applyDiscount(discountCodeInput.value);
      });

      paymentForm.addEventListener('submit', (event) => {
        event.preventDefault();
        if (validateForm()) {
          window.location.href = 'receipt.html';
        }
      });

      function validateForm() {
        const cardNumber = document.getElementById('card-number').value;
        const cardExpiry = document.getElementById('card-expiry').value;
        const cardCvc = document.getElementById('card-cvc').value;

        clearErrors();

        let isValid = true;

        if (!/^\d{16}$/.test(cardNumber)) {
          showError('card-number', 'Card number must be 16 digits.');
          isValid = false;
        }

        if (!/^(0[1-9]|1[0-2])\/\d{2}$/.test(cardExpiry)) {
          showError('card-expiry', 'Expiry date must be in MM/YY format.');
          isValid = false;
        }

        if (!/^\d{3}$/.test(cardCvc)) {
          showError('card-cvc', 'CVC must be 3 digits.');
          isValid = false;
        }

        return isValid;
      }

      function applyDiscount(code) {
        const discountCodes = {
          'MOVIE30': 0.30,
          'SUMMER20': 0.20,
          'WELCOME10': 0.10
        };
        if (discountCodes[code]) {
          discountedTotal = total * (1 - discountCodes[code]);
          totalElement.textContent = `Total after discount: $${discountedTotal.toFixed(2)}`;
          discountMessageElement.textContent = `Discount applied! New total: $${discountedTotal.toFixed(2)}`;
          disableDiscountButton();
          return true;
        } else {
          totalElement.textContent = `Total: $${total.toFixed(2)}`;
          discountMessageElement.textContent = 'Invalid discount code.';
        }
        return false;
      }

      function disableDiscountButton() {
        discountButton.disabled = true;
        discountButton.textContent = 'Discount Applied';
      }

      function showError(fieldId, message) {
        const field = document.getElementById(fieldId);
        const error = document.createElement('div');
        error.className = 'error';
        error.textContent = message;
        field.parentElement.appendChild(error);
      }

      function clearErrors() {
        document.querySelectorAll('.error').forEach(error => error.remove());
      }
    });
  </script>
</head>
<body>
<h1>Payment</h1>

<div class="summary" id="cart-summary"></div>
<p id="total-amount" class="summary"></p>

<section id="movie-details">
  <h2>Movie Details</h2>
  <p><strong>Movie:</strong> The Matrix</p>
  <p><strong>Time:</strong> 7:00 PM</p>
  <p><strong>Seats:</strong> ['A1', 'A2', 'A3']</p>
</section>

<section id="discount-section">
  <h2>Apply Discount</h2>
  <form id="discount-form">
    <label for="discount-code">Discount Code (optional)</label>
    <input type="text" id="discount-code" name="discount-code">
    <button type="submit" id="discount-button">Apply Discount</button>
    <p id="discount-message" class="message"></p>
  </form>
</section>

<section id="payment-section">
  <h2>Pay with Card</h2>
  <form id="payment-form" method="post">
    <label for="card-number">Card Number</label>
    <input type="text" id="card-number" name="card-number" required>

    <label for="card-expiry">Expiry Date (MM/YY)</label>
    <input type="text" id="card-expiry" name="card-expiry" required>

    <label for="card-cvc">CVC</label>
    <input type="text" id="card-cvc" name="card-cvc" required>

    <button type="submit">Submit Payment</button>
  </form>
</section>
</body>
</html>
